<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CampusBadge â€“ ì¸ì¦ì„œ DApp (ì˜¨ì²´ì¸/ë¡œì»¬ ê²¸ìš© ë°ëª¨)</title>
  <style>
    :root{ --bg:#0b1220; --card:#101828; --muted:#9aa4b2; --text:#e5eef7; --brand:#4f8cff; --ok:#22c55e; --warn:#f59e0b; --err:#ef4444; --bd:#223045; }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Helvetica, Arial;
      color:var(--text); background:
        radial-gradient(1200px 600px at 100% -10%, #27406040 10%, transparent 60%),
        radial-gradient(1000px 500px at 0% 0%, #1b2a4a40 10%, transparent 60%), var(--bg);
      line-height:1.5;
    }
    header{ position:sticky; top:0; backdrop-filter:saturate(140%) blur(8px); background:#0b1220cc; border-bottom:1px solid var(--bd); z-index:20; }
    .wrap{max-width:1050px; margin:0 auto; padding:16px}
    h1{font-size:20px; margin:8px 0; letter-spacing:.3px}
    .brand{display:flex; align-items:center; gap:10px}
    .badge{border:1px solid var(--bd); padding:2px 8px; border-radius:9999px; color:var(--muted); font-size:12px}
    .grid{display:grid; gap:16px}
    @media (min-width:960px){ .grid-2{grid-template-columns: 3fr 2fr} }
    .card{
      background:linear-gradient(180deg, #0f172a, #0c1325);
      border:1px solid var(--bd);
      border-radius:16px;
      padding:18px;
      box-shadow:0 10px 30px #0006;
    }
    .card h2{margin:0 0 10px 0; font-size:18px}
    label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    input, textarea, select{
      width:100%; padding:10px 12px; border-radius:12px; border:1px solid #24324a; background:#0a1326; color:var(--text);
      outline:none; transition:border .15s, box-shadow .15s; font-size:14px;
    }
    textarea{resize:vertical; min-height:90px}
    input:focus, textarea:focus, select:focus{border-color:#345; box-shadow:0 0 0 3px #4f8cff33}
    .row{display:grid; gap:12px}
    @media (min-width:760px){ .row-2{grid-template-columns:1fr 1fr} .row-3{grid-template-columns:1fr 1fr 1fr} }
    .btn{appearance:none; border:1px solid transparent; background:var(--brand); color:#fff; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600; font-size:13px}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .btn.ghost{background:#0b1220; border-color:var(--bd); color:var(--text)}
    .btn.warn{background:var(--warn); border-color:#0000}
    .btn.ok{background:var(--ok)}
    .btn.err{background:var(--err)}
    .flex{display:flex; gap:10px; align-items:center}
    .right{margin-left:auto}
    .muted{color:var(--muted)}
    .small{font-size:12px}
    .hr{height:1px; background:var(--bd); margin:12px 0}
    .table{width:100%; border-collapse:collapse; font-size:14px}
    .table th,.table td{border-bottom:1px solid #1b2942; padding:10px 8px; text-align:left}
    .status{padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid #23344f}
    .s-pending{background:#f59e0b22; color:#fbbf24}
    .s-minted{background:#22c55e22; color:#86efac}
    .s-rejected{background:#ef444422; color:#fca5a5}
    .s-revoked{background:#ef444422; color:#fecaca}
    .tabbar{display:flex; gap:8px; flex-wrap:wrap}
    .tabbar button{background:#0b1220; border:1px solid var(--bd); color:var(--text); padding:8px 12px; border-radius:999px; cursor:pointer; font-size:12px}
    .tabbar button.active{background:var(--brand); border-color:#0000}
    dialog{border:1px solid var(--bd); border-radius:16px; padding:0; background:#0b1220; color:#fff; width:min(720px, 92vw)}
    dialog::backdrop{background:#0008}
    .dlg-head{padding:14px 16px; border-bottom:1px solid var(--bd); font-weight:700}
    .dlg-body{padding:14px 16px}
    pre{margin:0; background:#071125; padding:12px; border-radius:12px; overflow:auto; max-height:60vh}
    .pill{border:1px solid var(--bd); border-radius:9999px; padding:4px 10px; font-size:12px; color:var(--muted)}
    .toast{position:fixed; bottom:16px; left:50%; transform:translateX(-50%); background:#0b1220; border:1px solid var(--bd); padding:10px 14px; border-radius:12px; box-shadow:0 10px 24px #0006; display:none; z-index:50}
    .toast.show{display:block}
    a{color:#9cc4ff}
  </style>
</head>
<body>
  <header>
    <div class="wrap flex">
      <div class="brand">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
          <path d="M12 3l7 4v6c0 4.418-3.582 8-8 8s-8-3.582-8-8V7l7-4z" stroke="#4f8cff" stroke-width="1.6"/>
          <path d="M9 10h6M9 14h6" stroke="#9cc4ff" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
        <h1>CampusBadge â€“ ì¸ì¦ì„œ ì›¹ ë°ëª¨(ì˜¨ì²´ì¸/ë¡œì»¬ ê²¸ìš©)</h1>
        <span class="badge">ì§€ê°‘ ì—°ê²° ì‹œ ì˜¨ì²´ì¸ Â· ë¯¸ì—°ê²° ì‹œ ë¡œì»¬</span>
      </div>
      <div class="right flex" style="gap:8px">
        <div class="pill" id="login-pill">ê³„ì •: <b>ë¡œê·¸ì¸ í•„ìš”</b></div>
        <button class="btn ghost small" id="btn-logout" style="display:none">ë¡œê·¸ì•„ì›ƒ</button>
        <div class="pill small">ë°ì´í„° ì €ì¥(ë¯¸ì—°ê²°): <b>LocalStorage</b></div>
      </div>
    </div>
  </header>

  <main class="wrap" style="margin-top:24px; margin-bottom:40px;">
    <!-- ğŸ” ë¡œê·¸ì¸ í™”ë©´ -->
    <section class="card" id="view-login">
      <h2>ë¡œê·¸ì¸</h2>
      <p class="small muted" style="margin-bottom:10px;">CampusBadge Demoì— ë¡œê·¸ì¸í•˜ì„¸ìš”.</p>
      <div class="row row-2">
        <div style="grid-column:1/-1">
          <label for="login-username">ì•„ì´ë””</label>
          <input id="login-username" placeholder="IDë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="username" />
        </div>
        <div style="grid-column:1/-1">
          <label for="login-password">ë¹„ë°€ë²ˆí˜¸</label>
          <input id="login-password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="current-password" />
        </div>
      </div>
      <div class="hr"></div>
      <div class="flex">
        <button class="btn ghost" id="btn-go-register">íšŒì›ê°€ì…</button>
        <span class="right"></span>
        <button class="btn" id="btn-login">ë¡œê·¸ì¸</button>
      </div>
    </section>

    <!-- ğŸ“ íšŒì›ê°€ì… í™”ë©´ -->
    <section class="card" id="view-register" hidden>
      <h2>íšŒì›ê°€ì…</h2>
      <p class="small muted" style="margin-bottom:10px;">ë°ëª¨ìš© ê³„ì •ì€ ë¸Œë¼ìš°ì € LocalStorageì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</p>
      <div class="row row-2">
        <div style="grid-column:1/-1">
          <label for="signup-username">ì•„ì´ë””</label>
          <input id="signup-username" placeholder="IDë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
        </div>
        <div style="grid-column:1/-1">
          <label for="signup-password">ë¹„ë°€ë²ˆí˜¸</label>
          <input id="signup-password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
        </div>
        <div style="grid-column:1/-1">
          <label for="signup-email">E-mail</label>
          <input id="signup-email" type="email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" />
        </div>
        <div style="grid-column:1/-1">
          <label for="signup-nickname">ë‹‰ë„¤ì„</label>
          <input id="signup-nickname" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" />
        </div>
        <div style="grid-column:1/-1">
          <label for="signup-role">ì—­í• </label>
          <select id="signup-role">
            <option value="user">ì¼ë°˜ ìœ ì €</option>
            <option value="admin">ê´€ë¦¬ì</option>
          </select>
        </div>
            <!-- ê´€ë¦¬ìì¼ ê²½ìš° ì§ì ‘ ì§€ê°‘ ì…ë ¥ -->
        <div style="grid-column:1/-1" id="admin-wallet-field" hidden>
          <label for="signup-wallet">ê´€ë¦¬ì ì§€ê°‘ ì£¼ì†Œ</label>
          <input id="signup-wallet" placeholder="0xë¡œ ì‹œì‘í•˜ëŠ” ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
        </div>
      </div>
      <div class="hr"></div>
      <div class="flex">
        <button class="btn ghost" id="btn-go-login">ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        <span class="right"></span>
        <button class="btn ok" id="btn-signup">íšŒì›ê°€ì… ì™„ë£Œ</button>
      </div>
    </section>

    <!-- ğŸ§© ë©”ì¸ DApp í™”ë©´ (ë¡œê·¸ì¸ í›„) -->
    <section id="view-main" hidden>
      <!-- ê°„ë‹¨í•œ í™˜ì˜ ì¹´ë“œ -->
      <section class="card" style="margin-bottom:16px">
        <div class="flex">
          <h2>ëŒ€ì‹œë³´ë“œ</h2>
          <span class="pill right small" id="welcome-text">ë¡œê·¸ì¸ ì •ë³´ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
        </div>
        <p class="small muted" style="margin-top:8px;">
          ì—­í• ì— ë”°ë¼ í™”ë©´ì´ ë‹¤ë¥´ê²Œ ë³´ì…ë‹ˆë‹¤. (ê´€ë¦¬ì: ëŒ€ì‹œë³´ë“œ / ì¼ë°˜ ìœ ì €: ì¸ì¦ì„œ ìš”ì²­ + ê¸°ì—… ê²€ì¦)
        </p>
      </section>

      <div class="grid grid-2" id="app">
        <!-- ì²´ì¸ ì—°ê²° ì„¹ì…˜ -->
        <section class="card" style="grid-column:1/-1" id="sec-chain">
          <div class="flex">
            <h2>ì²´ì¸ ì—°ê²°(ì„ íƒ)</h2>
            <span class="pill right">Ethers v6 Â· MetaMask</span>
          </div>
          <div class="row row-3">
            <div>
              <label>ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ (CampusCertNFT)</label>
              <input id="chain-address" placeholder="0x..." />
            </div>
            <div>
              <label>ë„¤íŠ¸ì›Œí¬(ì²´ì¸ID)</label>
              <input id="chain-id" placeholder="31337 / 11155420(OP Sepolia) / 10(OP Main)" />
            </div>
            <div class="flex" style="align-items:end">
              <button class="btn" id="btn-connect">ì§€ê°‘ ì—°ê²°</button>
              <button class="btn ghost" id="btn-disconnect">í•´ì œ</button>
            </div>
          </div>
          <div class="small muted" id="whoami">ì§€ê°‘ ë¯¸ì—°ê²°</div>
        </section>

        <!-- ì¢Œ: ì‹ ì²­/ì‘ì„± (ì¼ë°˜ ìœ ì € ì „ìš©) -->
        <section class="card" id="sec-request">
          <div class="flex">
            <h2>â‘  ì¸ì¦ì„œ ìš”ì²­ ë§Œë“¤ê¸°</h2>
            <span class="pill right">ì‹ ì²­ì í™”ë©´</span>
          </div>
          <p class="muted small">
            ì§€ê°‘ ë¯¸ì—°ê²°: ë¡œì»¬ <b>Pending</b> ì €ì¥ Â· ì§€ê°‘ ì—°ê²°+TokenURI ìˆìœ¼ë©´
            <b>createRequest(beneficiary, tokenURI)</b> ì˜¨ì²´ì¸ í˜¸ì¶œ
          </p>

          <div class="row row-2">
            <div>
              <label>ì¸ì¦ì„œ ì´ë¦„ (name)</label>
              <input id="f-name" placeholder="ì˜ˆ) ë´‰ì‚¬í™œë™ ì¸ì¦ì„œ" />
            </div>
            <div>
              <label>ë°œê¸‰ê¸°ê´€ (Issuer)</label>
              <input id="f-issuer" placeholder="Ajou Univ." value="Ajou Univ." />
            </div>

            <div class="row-2" style="grid-column:1/-1">
              <div>
                <label>ì´ë¯¸ì§€/PDF CID ë˜ëŠ” URL (image)</label>
                <input id="f-image" placeholder="ipfs://bafy... ë˜ëŠ” https://..." />
              </div>
              <div>
                <label>CertificateID</label>
                <input id="f-certid" placeholder="SCH-2025-0001" />
              </div>
            </div>

            <div class="row-3" style="grid-column:1/-1">
              <div>
                <!-- â˜… beneficiary ì˜ë¯¸ë¡œ ë³€ê²½ -->
                <label>Beneficiary (ìˆ˜í˜œì ì§€ê°‘ ì£¼ì†Œ)</label>
                <input id="f-issuedto" placeholder="0xë¡œ ì‹œì‘í•˜ëŠ” ì§€ê°‘ ì£¼ì†Œ" />
              </div>
              <div>
                <label>StudentID</label>
                <input id="f-studentid" placeholder="2023xxxxxx" />
              </div>
              <div>
                <label>IssuedAt (ë°œê¸‰ì¼)</label>
                <input id="f-issuedat" type="date" />
              </div>
            </div>

            <div style="grid-column:1/-1">
              <label>ì„¤ëª… (description)</label>
              <textarea id="f-desc" placeholder="ë‚´ìš©ì„ ê°„ë‹¨íˆ ì ì–´ì£¼ì„¸ìš”. (í•™ìƒ ì´ë¦„ ë“±ì€ ì—¬ê¸° ì ì–´ë„ ë©ë‹ˆë‹¤)"></textarea>
            </div>

            <div style="grid-column:1/-1">
              <label>TokenURI (ë©”íƒ€ë°ì´í„° CID, ì˜¨ì²´ì¸ ì „ì†¡ìš©)</label>
              <input id="f-tokenuri" placeholder="ipfs://bafy..." />
            </div>
          </div>

          <div class="hr"></div>

          <div class="flex">
            <button class="btn" id="btn-preview">ë©”íƒ€ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°</button>
            <button class="btn ghost" id="btn-download">ë©”íƒ€ë°ì´í„° JSON ë‹¤ìš´ë¡œë“œ</button>
            <span class="right"></span>
            <button class="btn ok" id="btn-create">ìš”ì²­ ìƒì„±</button>
          </div>
        </section>

        <!-- ìš°: ë„ì›€/ìš”ì•½ (ê³µí†µ) -->
        <aside class="card" id="sec-help">
          <h2>ê°€ì´ë“œ & ìƒíƒœ</h2>
          <div class="tabbar" style="margin:6px 0 10px">
            <button class="active" data-tab="t1">ìš”ì•½</button>
            <button data-tab="t2">ë°ì´í„° ê·œê²©</button>
            <button data-tab="t3">ì£¼ì˜ì‚¬í•­</button>
          </div>
          <div id="tab-t1">
            <p class="small muted">
              ì´ í˜ì´ì§€ëŠ” <b>ì˜¨ì²´ì¸/ë¡œì»¬ ê²¸ìš©</b> ë°ëª¨ì…ë‹ˆë‹¤. ì§€ê°‘ ì—°ê²° ì‹œ CampusCertNFT ì»¨íŠ¸ë™íŠ¸ì˜
              <code>createRequest/approve/reject/mintNFT</code>ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
            </p>
            <ul class="small">
              <li>â‘  ì…ë ¥ â†’ (ì§€ê°‘ O) <code>createRequest(beneficiary, tokenURI)</code> / (ì§€ê°‘ X) ë¡œì»¬ Pending ìƒì„±</li>
              <li>â‘¡ ê´€ë¦¬ì ìŠ¹ì¸/ë°˜ë ¤/ë¯¼íŒ…: onlyOwner ê³„ì • í•„ìš”(ì§€ê°‘ Xë©´ ë¡œì»¬ ìƒíƒœë³€ê²½)</li>
              <li>â‘¢ â€œê¸°ì—… ê²€ì¦â€ íƒ­: ë¡œì»¬ ë°ì´í„° ê¸°ì¤€ì˜ ëª¨ì˜ ì¡°íšŒ</li>
            </ul>
          </div>
          <div id="tab-t2" hidden>
            <p class="small">ê¶Œì¥ ë©”íƒ€ë°ì´í„°(JSON):</p>
            <pre class="small">{
  "name": "ë´‰ì‚¬í™œë™ ì¸ì¦ì„œ",
  "description": "êµë‚´ ë´‰ì‚¬í™œë™ 10ì‹œê°„",
  "image": "ipfs://&lt;IMAGE_CID&gt;",
  "attributes": [
    {"trait_type":"IssuedTo","value":"0x... (ìˆ˜í˜œì ì§€ê°‘ ì£¼ì†Œ)"},
    {"trait_type":"StudentID","value":"2023xxxxx"},
    {"trait_type":"IssuedAt","value":"2025-10-05"},
    {"trait_type":"Issuer","value":"Ajou Univ."},
    {"trait_type":"CertificateID","value":"SCH-2025-0001"}
  ]
}</pre>
          </div>
          <div id="tab-t3" hidden>
            <ul class="small">
              <li>ì»¨íŠ¸ë™íŠ¸ ì†Œìœ ìë§Œ ìŠ¹ì¸/ë°˜ë ¤/ë¯¼íŒ… ê°€ëŠ¥(onlyOwner).</li>
              <li>ë¡œì»¬ í…Œì´ë¸”ì€ ë¸Œë¼ìš°ì € ì €ì¥ì†Œ ê¸°ë°˜ì´ë¼ ì§€ìš°ë©´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.</li>
              <li>ì˜¨ì²´ì¸ ëª©ë¡ ì¡°íšŒëŠ” <code>requestCount()</code> / <code>requests(id)</code> ë·° í•¨ìˆ˜ì— ì˜ì¡´í•©ë‹ˆë‹¤.</li>
            </ul>
          </div>
        </aside>

        <!-- ê´€ë¦¬ì (ê´€ë¦¬ì ê³„ì • ì „ìš©) -->
        <section class="card" style="grid-column:1/-1" id="sec-admin">
          <div class="flex">
            <h2>â‘¡ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h2>
            <span class="pill right">ì§€ê°‘ ì—°ê²°+ì†Œìœ ìë©´ ì˜¨ì²´ì¸ Â· ì•„ë‹ˆë©´ ë¡œì»¬</span>
          </div>

          <div class="flex" style="margin-bottom:8px">
            <div class="flex" style="gap:6px">
              <button class="btn ghost" id="btn-refresh">ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
              <button class="btn ghost" id="btn-export">CSV ë‚´ë³´ë‚´ê¸°</button>
              <button class="btn err" id="btn-clear">ëª¨ë“  ë°ì´í„° ì‚­ì œ(ë¡œì»¬)</button>
            </div>
            <span class="right small muted">ìš”ì²­ ìˆ˜: <b id="count-total">0</b> ê±´</span>
          </div>

          <div class="hr"></div>

          <div class="row row-3">
            <div>
              <label>ìƒíƒœ í•„í„°</label>
              <select id="filter-status">
                <option value="">ì „ì²´</option>
                <option value="Pending">Pending</option>
                <option value="Minted">Minted</option>
                <option value="Rejected">Rejected</option>
                <option value="Revoked">Revoked</option>
              </select>
            </div>
            <div>
              <!-- â˜… beneficiary ê²€ìƒ‰ë„ í¬í•¨ -->
              <label>ê²€ìƒ‰ (CertificateID / StudentID / IssuedTo / Beneficiary)</label>
              <input id="filter-q" placeholder="ì˜ˆ) SCH-2025-0001, 2023xxxx, 0x..." />
            </div>
            <div class="flex" style="align-items:end">
              <button class="btn" id="btn-apply">í•„í„° ì ìš©</button>
              <button class="btn ghost" id="btn-reset">ì´ˆê¸°í™”</button>
            </div>
          </div>

          <div class="hr"></div>

          <div style="overflow:auto">
            <table class="table" id="tbl">
              <thead>
                <tr>
                  <th>RequestID</th>
                  <th>CertificateID</th>
                  <th>StudentID</th>
                  <th>IssuedTo (Beneficiary)</th>
                  <th>Status</th>
                  <th>IssuedAt</th>
                  <th>ì•¡ì…˜</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>
        </section>

        <!-- ê¸°ì—… ê²€ì¦ (ì¼ë°˜ ìœ ì € ì „ìš©) -->
        <section class="card" style="grid-column:1/-1" id="sec-verify">
          <div class="flex">
            <h2>â‘¢ ê¸°ì—… ê²€ì¦(ì¡°íšŒ) í¬í„¸ â€“ ë°ëª¨</h2>
            <span class="pill right">LocalStorage ê¸°ë°˜ ëª¨ì˜ ê²€ì¦</span>
          </div>
          <div class="row row-3">
            <div>
              <label>CertificateID</label>
              <input id="v-certid" placeholder="SCH-2025-0001" />
            </div>
            <div>
              <label>StudentID</label>
              <input id="v-studentid" placeholder="2023xxxxxx" />
            </div>
            <div>
              <!-- ì—¬ê¸°ì„œë„ IssuedToë¥¼ ì§€ê°‘ì£¼ì†Œ ê¸°ì¤€ìœ¼ë¡œ -->
              <label>IssuedTo / Beneficiary (ì§€ê°‘ ì£¼ì†Œ)</label>
              <input id="v-issuedto" placeholder="0x..." />
            </div>
          </div>
          <div class="flex" style="margin-top:10px">
            <button class="btn" id="btn-verify">ì¡°íšŒ</button>
            <span class="small muted right">â€» ì‹¤ì œ ê²€ì¦ì€ ì˜¨ì²´ì¸ ì´ë²¤íŠ¸/ì„œëª… ê²€ì¦ ë˜ëŠ” ì„œë²„ API ì‚¬ìš©</span>
          </div>
          <div id="verify-result" style="margin-top:12px"></div>
        </section>
      </div>
    </section>
  </main>

  <!-- Dialog: Preview -->
  <dialog id="dlg">
    <div class="dlg-head">ë©”íƒ€ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°</div>
    <div class="dlg-body">
      <pre id="preview-box">{}</pre>
      <div class="flex" style="margin-top:10px">
        <button class="btn ghost" id="dlg-close">ë‹«ê¸°</button>
        <button class="btn right" id="dlg-copy">JSON ë³µì‚¬</button>
      </div>
    </div>
  </dialog>

  <div class="toast" id="toast"></div>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
